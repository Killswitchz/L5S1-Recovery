<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1a1a2e">
    <title>L5-S1 Recovery Program</title>
    <link rel="manifest" href="manifest.json">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #fff;
        }
        #root { max-width: 500px; margin: 0 auto; padding: 16px; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .pulse { animation: pulse 1s infinite; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;

        // Sound notification using Web Audio API
        const useSound = () => {
            const audioContextRef = useRef(null);
            
            const playSound = useCallback((type = 'complete') => {
                try {
                    if (!audioContextRef.current) {
                        audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();
                    }
                    const ctx = audioContextRef.current;
                    
                    if (type === 'complete') {
                        [0, 0.15, 0.3].forEach((delay, i) => {
                            const osc = ctx.createOscillator();
                            const gain = ctx.createGain();
                            osc.connect(gain);
                            gain.connect(ctx.destination);
                            osc.frequency.value = 440 * Math.pow(1.25, i);
                            osc.type = 'sine';
                            gain.gain.setValueAtTime(0.3, ctx.currentTime + delay);
                            gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + delay + 0.3);
                            osc.start(ctx.currentTime + delay);
                            osc.stop(ctx.currentTime + delay + 0.3);
                        });
                    } else if (type === 'tick') {
                        const osc = ctx.createOscillator();
                        const gain = ctx.createGain();
                        osc.connect(gain);
                        gain.connect(ctx.destination);
                        osc.frequency.value = 880;
                        osc.type = 'sine';
                        gain.gain.setValueAtTime(0.2, ctx.currentTime);
                        gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
                        osc.start(ctx.currentTime);
                        osc.stop(ctx.currentTime + 0.1);
                    } else if (type === 'warning') {
                        const osc = ctx.createOscillator();
                        const gain = ctx.createGain();
                        osc.connect(gain);
                        gain.connect(ctx.destination);
                        osc.frequency.value = 660;
                        osc.type = 'square';
                        gain.gain.setValueAtTime(0.15, ctx.currentTime);
                        gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.15);
                        osc.start(ctx.currentTime);
                        osc.stop(ctx.currentTime + 0.15);
                    }
                } catch (e) {
                    console.log('Audio not supported');
                }
            }, []);

            return playSound;
        };

        // Local Storage helpers
        const saveToStorage = (key, value) => {
            try {
                localStorage.setItem(key, JSON.stringify(value));
            } catch (e) {
                console.log('Storage not available');
            }
        };

        const loadFromStorage = (key, defaultValue) => {
            try {
                const item = localStorage.getItem(key);
                return item ? JSON.parse(item) : defaultValue;
            } catch (e) {
                return defaultValue;
            }
        };

        const exerciseData = {
            proneLying: { name: 'Prone Lying', duration: 180, type: 'hold', sets: 1, reps: 1, instructions: 'Lie face-down, arms at sides, head turned. Let lower back completely relax.', target: 'Disc unloading', illustration: 'prone' },
            sphinxPose: { name: 'Sphinx Pose', duration: 120, type: 'hold', sets: 1, reps: 1, instructions: 'Prop on forearms, elbows under shoulders. Keep hips on floor, relax lower back.', target: 'Passive extension', illustration: 'sphinx' },
            pronePressUp: { name: 'Prone Press-Up', duration: 2, type: 'reps', sets: 1, reps: 10, instructions: 'Push upper body up, keep hips on floor. Let back sag. Hold 1-2 sec at top.', target: 'McKenzie extension', illustration: 'pressup' },
            abdominalDrawIn: { name: 'Abdominal Drawing-In', duration: 10, type: 'reps', sets: 3, reps: 10, instructions: 'Lie on back, knees bent. Draw belly button toward spine gently.', target: 'Core activation', illustration: 'drawin' },
            pelvicTilt: { name: 'Pelvic Tilt', duration: 5, type: 'reps', sets: 2, reps: 10, instructions: 'Lie on back, flatten lower back into floor by tilting pelvis. Hold 3-5 sec.', target: 'Lumbar mobility', illustration: 'pelvictilt' },
            gluteBridge: { name: 'Glute Bridge', duration: 5, type: 'reps', sets: 2, reps: 10, instructions: 'Lie on back, knees bent. Squeeze glutes, lift hips. Hold 5 sec at top.', target: 'Glute activation', illustration: 'bridge' },
            gentleWalking: { name: 'Gentle Walking', duration: 600, type: 'hold', sets: 1, reps: 1, instructions: 'Walk on flat terrain at conversational pace. Upright posture.', target: 'Circulation', illustration: 'walking' },
            standingExtension: { name: 'Standing Extension', duration: 2, type: 'reps', sets: 1, reps: 10, instructions: 'Hands on lower back, bend backward. Keep knees straight.', target: 'Extension mobility', illustration: 'standingext' },
            supineNerveSlider: { name: 'Sciatic Nerve Slider', duration: 5, type: 'reps', sets: 1, reps: 5, instructions: 'Pull knee to chest, slowly straighten. Flex/point foot to slide nerve.', target: 'Neural mobility', illustration: 'nerveslider' },
            kneeToChest: { name: 'Knee to Chest', duration: 3, type: 'reps', sets: 1, reps: 10, instructions: 'Lie on back, pull one knee to chest. Hold briefly, alternate.', target: 'Flexion mobility', illustration: 'kneetochest' },
            heelSlides: { name: 'Heel Slides', duration: 3, type: 'reps', sets: 2, reps: 10, instructions: 'Lie on back, slide heel out while keeping back flat. Alternate.', target: 'Core control', illustration: 'heelslide' },
            birdDog: { name: 'Bird Dog', duration: 5, type: 'reps', sets: 2, reps: 10, instructions: 'On hands and knees, lift opposite arm and leg. Hold 5 sec.', target: 'Spinal stability', illustration: 'birddog' },
            modifiedPlank: { name: 'Modified Plank', duration: 20, type: 'hold', sets: 2, reps: 1, instructions: 'Forearms and knees on ground. Straight line head to knees.', target: 'Core endurance', illustration: 'plank' },
            piriformisStretch: { name: 'Piriformis Stretch', duration: 20, type: 'hold', sets: 2, reps: 1, instructions: 'Cross ankle over knee. Pull thigh toward chest. Feel stretch in buttock.', target: 'Hip mobility', illustration: 'piriformis' },
            hipFlexorStretch: { name: 'Hip Flexor Stretch', duration: 30, type: 'hold', sets: 2, reps: 1, instructions: 'Half-kneeling, squeeze glutes, shift forward. Feel front hip stretch.', target: 'Hip mobility', illustration: 'hipflexor' },
            frontPlank: { name: 'Front Plank', duration: 30, type: 'hold', sets: 3, reps: 1, instructions: 'Forearms and toes. Straight line head to heels. Squeeze glutes.', target: 'Core endurance', illustration: 'plank' },
            sidePlank: { name: 'Side Plank', duration: 15, type: 'hold', sets: 2, reps: 1, instructions: 'Side-lying, prop on elbow. Lift hips. Straight line.', target: 'Lateral stability', illustration: 'sideplank' },
            clamshell: { name: 'Clamshell', duration: 4, type: 'reps', sets: 2, reps: 15, instructions: 'Side-lying, knees bent. Lift top knee, keep heels together.', target: 'Hip strength', illustration: 'clamshell' },
            wallSit: { name: 'Wall Squat', duration: 20, type: 'hold', sets: 3, reps: 1, instructions: 'Back against wall, slide down to 90¬∞ knees. Hold.', target: 'Leg strength', illustration: 'wallsit' },
            hipHinge: { name: 'Hip Hinge', duration: 3, type: 'reps', sets: 2, reps: 10, instructions: 'Push hips back, keep back flat. Knees slightly bent.', target: 'Movement pattern', illustration: 'hiphinge' },
            singleLegBridge: { name: 'Single Leg Bridge', duration: 3, type: 'reps', sets: 2, reps: 10, instructions: 'One leg extended, bridge on single leg. Lower with control.', target: 'Glute max', illustration: 'singlelegbridge' },
            squat: { name: 'Bodyweight Squat', duration: 3, type: 'reps', sets: 2, reps: 15, instructions: 'Feet shoulder-width, sit back and down. Keep chest up.', target: 'Functional strength', illustration: 'squat' },
            lunge: { name: 'Stationary Lunge', duration: 3, type: 'reps', sets: 2, reps: 10, instructions: 'Step forward, lower back knee toward floor. Push through front heel.', target: 'Leg strength', illustration: 'lunge' }
        };

        const weeklyPrograms = {
            1: { name: 'Week 1: Foundation', phase: 1, desc: 'Establish baseline, reduce inflammation', morning: ['proneLying', 'sphinxPose', 'pronePressUp', 'abdominalDrawIn'], midday: ['pronePressUp', 'standingExtension', 'gentleWalking'], evening: ['proneLying', 'pronePressUp', 'pelvicTilt', 'supineNerveSlider'] },
            2: { name: 'Week 2: Building Consistency', phase: 1, desc: 'Increase frequency, add glute activation', morning: ['proneLying', 'pronePressUp', 'abdominalDrawIn', 'gluteBridge'], midday: ['pronePressUp', 'standingExtension', 'gentleWalking'], evening: ['sphinxPose', 'pronePressUp', 'pelvicTilt', 'gluteBridge'] },
            3: { name: 'Week 3: Early Mobility', phase: 2, desc: 'Introduce controlled flexion', morning: ['pronePressUp', 'kneeToChest', 'heelSlides', 'birdDog'], midday: ['standingExtension', 'gentleWalking', 'piriformisStretch'], evening: ['pronePressUp', 'modifiedPlank', 'hipFlexorStretch'] },
            4: { name: 'Week 4: Consolidation', phase: 2, desc: 'Build consistency in Phase 2', morning: ['pronePressUp', 'heelSlides', 'birdDog', 'gluteBridge'], midday: ['standingExtension', 'gentleWalking', 'piriformisStretch'], evening: ['kneeToChest', 'modifiedPlank', 'hipFlexorStretch'] },
            5: { name: 'Week 5: Progressive Loading', phase: 3, desc: 'Advance core exercises', morning: ['pronePressUp', 'heelSlides', 'birdDog', 'frontPlank'], midday: ['standingExtension', 'gentleWalking', 'clamshell'], evening: ['piriformisStretch', 'hipFlexorStretch', 'sidePlank'] },
            6: { name: 'Week 6: Strength Building', phase: 3, desc: 'Add wall squats and hip hinges', morning: ['pronePressUp', 'birdDog', 'frontPlank'], midday: ['wallSit', 'hipHinge', 'gentleWalking'], evening: ['sidePlank', 'clamshell', 'piriformisStretch'] },
            7: { name: 'Week 7: Endurance Focus', phase: 3, desc: 'Increase hold times and reps', morning: ['pronePressUp', 'birdDog', 'gluteBridge'], midday: ['frontPlank', 'wallSit', 'gentleWalking'], evening: ['sidePlank', 'hipHinge', 'piriformisStretch'] },
            8: { name: 'Week 8: Phase 3 Mastery', phase: 3, desc: 'Consolidate all Phase 3', morning: ['birdDog', 'frontPlank', 'gluteBridge'], midday: ['wallSit', 'clamshell', 'gentleWalking'], evening: ['sidePlank', 'hipHinge', 'piriformisStretch'] },
            9: { name: 'Week 9: Functional Start', phase: 4, desc: 'Begin advanced exercises', morning: ['birdDog', 'frontPlank', 'singleLegBridge'], midday: ['squat', 'gentleWalking'], evening: ['sidePlank', 'piriformisStretch', 'hipFlexorStretch'] },
            10: { name: 'Week 10: Building Power', phase: 4, desc: 'Add lunges', morning: ['birdDog', 'frontPlank', 'singleLegBridge'], midday: ['squat', 'lunge', 'gentleWalking'], evening: ['sidePlank', 'piriformisStretch'] },
            11: { name: 'Week 11: Integration', phase: 4, desc: 'Full functional program', morning: ['birdDog', 'frontPlank', 'singleLegBridge'], midday: ['squat', 'lunge', 'hipHinge'], evening: ['sidePlank', 'piriformisStretch', 'hipFlexorStretch'] },
            12: { name: 'Week 12: Graduation', phase: 4, desc: 'Prepare for maintenance', morning: ['birdDog', 'frontPlank', 'singleLegBridge'], midday: ['squat', 'lunge', 'gentleWalking'], evening: ['sidePlank', 'piriformisStretch', 'hipFlexorStretch'] }
        };

        const Illustration = ({ type }) => {
            const svgs = {
                prone: (
                    <svg viewBox="0 0 200 80" style={{ width: '100%', height: 64 }}>
                        <rect x="10" y="60" width="180" height="6" rx="3" fill="#334155"/>
                        <ellipse cx="100" cy="48" rx="60" ry="14" fill="#667eea"/>
                        <circle cx="35" cy="45" r="14" fill="#fbbf24"/>
                        <rect x="140" y="42" width="45" height="10" rx="5" fill="#4f46e5"/>
                        <rect x="140" y="50" width="45" height="10" rx="5" fill="#6366f1"/>
                    </svg>
                ),
                sphinx: (
                    <svg viewBox="0 0 200 100" style={{ width: '100%', height: 80 }}>
                        <rect x="10" y="80" width="180" height="6" rx="3" fill="#334155"/>
                        <ellipse cx="120" cy="68" rx="50" ry="12" fill="#667eea"/>
                        <path d="M70 68 Q50 50 60 35" stroke="#667eea" strokeWidth="20" fill="none" strokeLinecap="round"/>
                        <circle cx="55" cy="28" r="14" fill="#fbbf24"/>
                        <rect x="150" y="62" width="40" height="10" rx="5" fill="#4f46e5"/>
                    </svg>
                ),
                pressup: (
                    <svg viewBox="0 0 200 110" style={{ width: '100%', height: 96 }}>
                        <rect x="10" y="90" width="180" height="6" rx="3" fill="#334155"/>
                        <ellipse cx="140" cy="80" rx="35" ry="12" fill="#667eea"/>
                        <path d="M110 80 Q80 60 70 35" stroke="#667eea" strokeWidth="22" fill="none" strokeLinecap="round"/>
                        <circle cx="65" cy="25" r="14" fill="#fbbf24"/>
                        <ellipse cx="92" cy="85" rx="8" ry="6" fill="#fbbf24"/>
                        <ellipse cx="108" cy="85" rx="8" ry="6" fill="#fbbf24"/>
                        <rect x="160" y="74" width="35" height="10" rx="5" fill="#4f46e5"/>
                        <text x="130" y="65" fill="#ef4444" fontSize="10" fontWeight="bold">HIPS DOWN</text>
                    </svg>
                ),
                drawin: (
                    <svg viewBox="0 0 200 80" style={{ width: '100%', height: 64 }}>
                        <rect x="10" y="65" width="180" height="6" rx="3" fill="#334155"/>
                        <ellipse cx="100" cy="50" rx="50" ry="15" fill="#667eea"/>
                        <circle cx="40" cy="48" r="12" fill="#fbbf24"/>
                        <path d="M130 35 L145 50 L130 50" stroke="#4f46e5" strokeWidth="8" fill="none"/>
                        <path d="M100 38 L100 28" stroke="#22c55e" strokeWidth="2" strokeDasharray="3,2"/>
                        <text x="80" y="23" fill="#22c55e" fontSize="10">draw in</text>
                    </svg>
                ),
                pelvictilt: (
                    <svg viewBox="0 0 200 80" style={{ width: '100%', height: 64 }}>
                        <rect x="10" y="65" width="180" height="6" rx="3" fill="#334155"/>
                        <ellipse cx="90" cy="50" rx="45" ry="14" fill="#667eea"/>
                        <circle cx="40" cy="48" r="12" fill="#fbbf24"/>
                        <path d="M120 50 L140 35 L155 50" stroke="#4f46e5" strokeWidth="10" fill="none" strokeLinejoin="round"/>
                        <text x="65" y="72" fill="#22c55e" fontSize="9">flatten back</text>
                    </svg>
                ),
                bridge: (
                    <svg viewBox="0 0 200 80" style={{ width: '100%', height: 64 }}>
                        <rect x="10" y="65" width="180" height="6" rx="3" fill="#334155"/>
                        <circle cx="35" cy="55" r="12" fill="#fbbf24"/>
                        <path d="M50 55 Q100 20 140 55" stroke="#667eea" strokeWidth="16" fill="none"/>
                        <path d="M135 55 L150 65 L160 55" stroke="#4f46e5" strokeWidth="10" fill="none" strokeLinejoin="round"/>
                        <text x="85" y="15" fill="#22c55e" fontSize="10">lift hips</text>
                    </svg>
                ),
                walking: (
                    <svg viewBox="0 0 200 100" style={{ width: '100%', height: 80 }}>
                        <rect x="0" y="85" width="200" height="15" fill="#334155"/>
                        <circle cx="100" cy="20" r="12" fill="#fbbf24"/>
                        <rect x="94" y="32" width="12" height="28" rx="4" fill="#667eea"/>
                        <rect x="92" y="58" width="8" height="25" rx="4" fill="#4f46e5" transform="rotate(-10 92 58)"/>
                        <rect x="100" y="58" width="8" height="25" rx="4" fill="#6366f1" transform="rotate(15 100 58)"/>
                    </svg>
                ),
                standingext: (
                    <svg viewBox="0 0 200 100" style={{ width: '100%', height: 80 }}>
                        <rect x="0" y="85" width="200" height="15" fill="#334155"/>
                        <circle cx="110" cy="20" r="12" fill="#fbbf24"/>
                        <path d="M100 85 Q95 55 110 30" stroke="#667eea" strokeWidth="16" fill="none" strokeLinecap="round"/>
                        <path d="M115 15 Q130 5 135 20" stroke="#22c55e" strokeWidth="2" fill="none"/>
                    </svg>
                ),
                nerveslider: (
                    <svg viewBox="0 0 200 80" style={{ width: '100%', height: 64 }}>
                        <rect x="10" y="65" width="180" height="6" rx="3" fill="#334155"/>
                        <ellipse cx="80" cy="52" rx="40" ry="14" fill="#667eea"/>
                        <circle cx="35" cy="50" r="12" fill="#fbbf24"/>
                        <path d="M100 45 Q130 30 155 45" stroke="#4f46e5" strokeWidth="10" fill="none"/>
                        <ellipse cx="165" cy="42" rx="10" ry="8" fill="#fbbf24"/>
                    </svg>
                ),
                kneetochest: (
                    <svg viewBox="0 0 200 80" style={{ width: '100%', height: 64 }}>
                        <rect x="10" y="65" width="180" height="6" rx="3" fill="#334155"/>
                        <ellipse cx="80" cy="50" rx="40" ry="14" fill="#667eea"/>
                        <circle cx="35" cy="48" r="12" fill="#fbbf24"/>
                        <ellipse cx="115" cy="38" rx="18" ry="12" fill="#4f46e5"/>
                        <rect x="130" y="55" width="35" height="10" rx="5" fill="#6366f1"/>
                    </svg>
                ),
                heelslide: (
                    <svg viewBox="0 0 200 80" style={{ width: '100%', height: 64 }}>
                        <rect x="10" y="65" width="180" height="6" rx="3" fill="#334155"/>
                        <ellipse cx="80" cy="52" rx="40" ry="13" fill="#667eea"/>
                        <circle cx="35" cy="50" r="12" fill="#fbbf24"/>
                        <path d="M110 52 L165 58" stroke="#4f46e5" strokeWidth="10" fill="none" strokeLinecap="round"/>
                        <ellipse cx="172" cy="60" rx="8" ry="6" fill="#fbbf24"/>
                    </svg>
                ),
                birddog: (
                    <svg viewBox="0 0 200 80" style={{ width: '100%', height: 64 }}>
                        <rect x="10" y="65" width="180" height="6" rx="3" fill="#334155"/>
                        <ellipse cx="100" cy="48" rx="35" ry="12" fill="#667eea"/>
                        <circle cx="70" cy="32" r="10" fill="#fbbf24"/>
                        <path d="M50 35 L30 25" stroke="#fbbf24" strokeWidth="5" fill="none" strokeLinecap="round"/>
                        <rect x="125" y="40" width="45" height="8" rx="4" fill="#4f46e5"/>
                    </svg>
                ),
                plank: (
                    <svg viewBox="0 0 200 60" style={{ width: '100%', height: 48 }}>
                        <rect x="10" y="48" width="180" height="6" rx="3" fill="#334155"/>
                        <path d="M40 42 L160 35" stroke="#667eea" strokeWidth="12" fill="none" strokeLinecap="round"/>
                        <circle cx="35" cy="28" r="10" fill="#fbbf24"/>
                        <ellipse cx="165" cy="42" rx="6" ry="5" fill="#fbbf24"/>
                    </svg>
                ),
                piriformis: (
                    <svg viewBox="0 0 200 80" style={{ width: '100%', height: 64 }}>
                        <rect x="10" y="65" width="180" height="6" rx="3" fill="#334155"/>
                        <ellipse cx="80" cy="52" rx="40" ry="14" fill="#667eea"/>
                        <circle cx="35" cy="50" r="12" fill="#fbbf24"/>
                        <path d="M105 45 L125 32 L145 50" stroke="#4f46e5" strokeWidth="8" fill="none" strokeLinejoin="round"/>
                        <rect x="130" y="52" width="30" height="8" rx="4" fill="#6366f1"/>
                    </svg>
                ),
                hipflexor: (
                    <svg viewBox="0 0 200 90" style={{ width: '100%', height: 72 }}>
                        <rect x="10" y="75" width="180" height="6" rx="3" fill="#334155"/>
                        <rect x="90" y="30" width="14" height="32" rx="4" fill="#667eea"/>
                        <circle cx="97" cy="20" r="10" fill="#fbbf24"/>
                        <path d="M93 60 L78 75" stroke="#4f46e5" strokeWidth="8" fill="none" strokeLinecap="round"/>
                        <path d="M100 60 L125 48 L125 75" stroke="#6366f1" strokeWidth="8" fill="none" strokeLinejoin="round"/>
                    </svg>
                ),
                sideplank: (
                    <svg viewBox="0 0 200 70" style={{ width: '100%', height: 56 }}>
                        <rect x="10" y="58" width="180" height="6" rx="3" fill="#334155"/>
                        <path d="M50 55 L140 30" stroke="#667eea" strokeWidth="12" fill="none" strokeLinecap="round"/>
                        <circle cx="148" cy="22" r="10" fill="#fbbf24"/>
                        <ellipse cx="45" cy="55" rx="8" ry="6" fill="#fbbf24"/>
                    </svg>
                ),
                clamshell: (
                    <svg viewBox="0 0 200 70" style={{ width: '100%', height: 56 }}>
                        <rect x="10" y="55" width="180" height="6" rx="3" fill="#334155"/>
                        <ellipse cx="80" cy="42" rx="35" ry="12" fill="#667eea"/>
                        <circle cx="40" cy="40" r="10" fill="#fbbf24"/>
                        <path d="M105 38 L125 48 L125 55" stroke="#4f46e5" strokeWidth="8" fill="none" strokeLinejoin="round"/>
                        <path d="M105 42 L130 28" stroke="#6366f1" strokeWidth="8" fill="none" strokeLinecap="round"/>
                    </svg>
                ),
                wallsit: (
                    <svg viewBox="0 0 200 90" style={{ width: '100%', height: 72 }}>
                        <rect x="20" y="5" width="8" height="80" fill="#475569"/>
                        <rect x="0" y="80" width="200" height="10" fill="#334155"/>
                        <rect x="32" y="28" width="12" height="28" rx="4" fill="#667eea"/>
                        <circle cx="38" cy="18" r="10" fill="#fbbf24"/>
                        <path d="M35 55 L50 72 L35 72" stroke="#4f46e5" strokeWidth="8" fill="none" strokeLinejoin="round"/>
                        <text x="60" y="50" fill="#22c55e" fontSize="10">90¬∞</text>
                    </svg>
                ),
                hiphinge: (
                    <svg viewBox="0 0 200 90" style={{ width: '100%', height: 72 }}>
                        <rect x="0" y="75" width="200" height="15" fill="#334155"/>
                        <path d="M100 75 Q95 50 80 35" stroke="#667eea" strokeWidth="14" fill="none" strokeLinecap="round"/>
                        <circle cx="75" cy="28" r="10" fill="#fbbf24"/>
                        <rect x="98" y="55" width="8" height="20" rx="4" fill="#4f46e5"/>
                        <text x="55" y="48" fill="#22c55e" fontSize="9">hips back</text>
                    </svg>
                ),
                singlelegbridge: (
                    <svg viewBox="0 0 200 70" style={{ width: '100%', height: 56 }}>
                        <rect x="10" y="55" width="180" height="6" rx="3" fill="#334155"/>
                        <circle cx="35" cy="45" r="10" fill="#fbbf24"/>
                        <path d="M48 45 Q90 18 120 45" stroke="#667eea" strokeWidth="12" fill="none"/>
                        <path d="M118 45 L150 28" stroke="#4f46e5" strokeWidth="8" fill="none" strokeLinecap="round"/>
                        <path d="M122 45 L138 55 L148 45" stroke="#6366f1" strokeWidth="6" fill="none" strokeLinejoin="round"/>
                    </svg>
                ),
                squat: (
                    <svg viewBox="0 0 200 90" style={{ width: '100%', height: 72 }}>
                        <rect x="0" y="78" width="200" height="12" fill="#334155"/>
                        <rect x="94" y="32" width="12" height="22" rx="4" fill="#667eea"/>
                        <circle cx="100" cy="22" r="10" fill="#fbbf24"/>
                        <path d="M95 52 L82 70 L95 78" stroke="#4f46e5" strokeWidth="8" fill="none" strokeLinejoin="round"/>
                        <path d="M105 52 L118 70 L105 78" stroke="#6366f1" strokeWidth="8" fill="none" strokeLinejoin="round"/>
                    </svg>
                ),
                lunge: (
                    <svg viewBox="0 0 200 90" style={{ width: '100%', height: 72 }}>
                        <rect x="0" y="78" width="200" height="12" fill="#334155"/>
                        <rect x="94" y="28" width="12" height="28" rx="4" fill="#667eea"/>
                        <circle cx="100" cy="18" r="10" fill="#fbbf24"/>
                        <path d="M95 55 L72 70 L72 78" stroke="#4f46e5" strokeWidth="8" fill="none" strokeLinejoin="round"/>
                        <path d="M105 55 L128 42 L140 70 L140 78" stroke="#6366f1" strokeWidth="8" fill="none" strokeLinejoin="round"/>
                    </svg>
                )
            };
            return svgs[type] || svgs.prone;
        };

        const Timer = ({ duration, onComplete }) => {
            const [timeLeft, setTimeLeft] = useState(duration);
            const [running, setRunning] = useState(false);
            const [soundEnabled, setSoundEnabled] = useState(true);
            const playSound = useSound();

            useEffect(() => { setTimeLeft(duration); setRunning(false); }, [duration]);

            useEffect(() => {
                if (!running || timeLeft <= 0) return;
                const t = setTimeout(() => setTimeLeft(timeLeft - 1), 1000);
                return () => clearTimeout(t);
            }, [running, timeLeft]);

            useEffect(() => {
                if (!running || !soundEnabled) return;
                if ([10, 5, 4, 3, 2, 1].includes(timeLeft)) {
                    playSound('warning');
                }
            }, [timeLeft, running, soundEnabled, playSound]);

            useEffect(() => {
                if (timeLeft === 0 && running) {
                    setRunning(false);
                    if (soundEnabled) playSound('complete');
                    onComplete();
                }
            }, [timeLeft, running, onComplete, soundEnabled, playSound]);

            const pct = ((duration - timeLeft) / duration) * 100;
            const mins = Math.floor(timeLeft / 60);
            const secs = timeLeft % 60;

            const getColor = () => {
                if (timeLeft === 0) return '#22c55e';
                if (timeLeft <= 5) return '#ef4444';
                if (timeLeft <= 10) return '#f59e0b';
                return '#667eea';
            };

            return (
                <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: 12, margin: '16px 0' }}>
                    <div style={{ position: 'relative', width: 100, height: 100 }}>
                        <svg width="100" height="100" viewBox="0 0 100 100">
                            <circle cx="50" cy="50" r="45" fill="none" stroke="#334155" strokeWidth="8"/>
                            <circle cx="50" cy="50" r="45" fill="none" stroke={getColor()} strokeWidth="8" strokeLinecap="round" strokeDasharray={283} strokeDashoffset={283 * (1 - pct / 100)} transform="rotate(-90 50 50)" style={{ transition: 'stroke-dashoffset 0.3s, stroke 0.3s' }}/>
                        </svg>
                        <div style={{ position: 'absolute', top: '50%', left: '50%', transform: 'translate(-50%, -50%)', fontSize: 24, fontWeight: 'bold', color: getColor(), transition: 'color 0.3s' }}>
                            {mins}:{secs.toString().padStart(2, '0')}
                        </div>
                    </div>
                    <div style={{ display: 'flex', gap: 8, alignItems: 'center' }}>
                        <button onClick={() => { if (!running && soundEnabled) playSound('tick'); setRunning(!running); }} style={{ width: 52, height: 52, borderRadius: '50%', border: 'none', background: running ? '#ef4444' : '#22c55e', color: '#fff', fontSize: 20, cursor: 'pointer', boxShadow: '0 4px 12px rgba(0,0,0,0.3)' }}>
                            {running ? '‚è∏' : '‚ñ∂'}
                        </button>
                        <button onClick={() => { setRunning(false); setTimeLeft(duration); }} style={{ width: 44, height: 44, borderRadius: '50%', border: 'none', background: '#64748b', color: '#fff', fontSize: 18, cursor: 'pointer' }}>‚Ü∫</button>
                        <button onClick={() => setSoundEnabled(!soundEnabled)} style={{ width: 44, height: 44, borderRadius: '50%', border: 'none', background: soundEnabled ? '#667eea' : '#475569', color: '#fff', fontSize: 18, cursor: 'pointer' }}>
                            {soundEnabled ? 'üîä' : 'üîá'}
                        </button>
                    </div>
                    {timeLeft <= 10 && timeLeft > 0 && running && (
                        <div className="pulse" style={{ color: timeLeft <= 5 ? '#ef4444' : '#f59e0b', fontWeight: 'bold', fontSize: 14 }}>
                            {timeLeft <= 5 ? '‚ö†Ô∏è Almost done!' : '‚è∞ 10 seconds remaining'}
                        </div>
                    )}
                </div>
            );
        };

        const RepCounter = ({ sets, reps, onComplete }) => {
            const [set, setSet] = useState(1);
            const [rep, setRep] = useState(0);
            const [done, setDone] = useState(false);
            const playSound = useSound();

            const addRep = () => {
                if (done) return;
                playSound('tick');
                const newRep = rep + 1;
                if (newRep >= reps) {
                    if (set >= sets) { setRep(reps); setDone(true); playSound('complete'); onComplete(); }
                    else { setSet(set + 1); setRep(0); playSound('warning'); }
                } else { setRep(newRep); }
            };

            const reset = () => { setSet(1); setRep(0); setDone(false); };
            const pct = ((set - 1) * reps + rep) / (sets * reps) * 100;

            return (
                <div style={{ margin: '16px 0' }}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 8, color: '#94a3b8' }}>
                        <span>Set {set}/{sets}</span>
                        <span style={{ fontWeight: 'bold', color: '#fff', fontSize: 20 }}>{rep}/{reps}</span>
                    </div>
                    <div style={{ height: 8, background: '#334155', borderRadius: 4, overflow: 'hidden', marginBottom: 12 }}>
                        <div style={{ height: '100%', width: `${pct}%`, background: done ? '#22c55e' : 'linear-gradient(90deg, #667eea, #764ba2)', borderRadius: 4, transition: 'width 0.3s' }}/>
                    </div>
                    <div style={{ display: 'flex', gap: 8 }}>
                        <button onClick={addRep} disabled={done} style={{ flex: 1, padding: 14, border: 'none', borderRadius: 12, background: done ? '#22c55e' : '#667eea', color: '#fff', fontWeight: 600, fontSize: 16, cursor: 'pointer', opacity: done ? 0.7 : 1, boxShadow: '0 4px 12px rgba(0,0,0,0.3)' }}>
                            {done ? '‚úì Done' : '+1 Rep'}
                        </button>
                        <button onClick={reset} style={{ padding: '14px 18px', border: 'none', borderRadius: 12, background: '#64748b', color: '#fff', cursor: 'pointer', fontSize: 16 }}>‚Ü∫</button>
                    </div>
                </div>
            );
        };

        const ExerciseCard = ({ id, data, completed, onComplete, index }) => {
            const [open, setOpen] = useState(false);
            return (
                <div style={{ background: 'rgba(255,255,255,0.05)', borderRadius: 12, marginBottom: 8, border: `2px solid ${completed ? '#22c55e' : 'rgba(255,255,255,0.1)'}`, opacity: completed ? 0.6 : 1, overflow: 'hidden', transition: 'all 0.3s' }}>
                    <div onClick={() => setOpen(!open)} style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: 12, cursor: 'pointer' }}>
                        <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>
                            <div style={{ width: 32, height: 32, borderRadius: '50%', background: completed ? '#22c55e' : '#475569', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: 14, fontWeight: 'bold', color: '#fff' }}>{completed ? '‚úì' : index + 1}</div>
                            <div>
                                <div style={{ fontWeight: 600, color: '#fff', fontSize: 15 }}>{data.name}</div>
                                <div style={{ fontSize: 12, color: '#94a3b8' }}>{data.target}</div>
                            </div>
                        </div>
                        <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>
                            <span style={{ background: '#334155', padding: '5px 12px', borderRadius: 12, fontSize: 13, color: '#fff', fontWeight: 500 }}>
                                {data.type === 'hold' ? `${Math.floor(data.duration / 60)}:${(data.duration % 60).toString().padStart(2, '0')}` : `${data.sets}√ó${data.reps}`}
                            </span>
                            <span style={{ color: '#64748b', fontSize: 12 }}>{open ? '‚ñ≤' : '‚ñº'}</span>
                        </div>
                    </div>
                    {open && (
                        <div style={{ padding: '0 12px 12px', borderTop: '1px solid rgba(255,255,255,0.1)' }}>
                            <div style={{ background: 'linear-gradient(180deg, #0f172a, #1e293b)', borderRadius: 12, padding: 16, margin: '12px 0', display: 'flex', justifyContent: 'center' }}>
                                <Illustration type={data.illustration} />
                            </div>
                            <div style={{ color: '#cbd5e1', fontSize: 14, lineHeight: 1.6, padding: 12, background: 'rgba(0,0,0,0.2)', borderRadius: 8, marginBottom: 12 }}>{data.instructions}</div>
                            {data.type === 'hold' ? <Timer duration={data.duration} onComplete={onComplete} /> : <RepCounter sets={data.sets} reps={data.reps} onComplete={onComplete} />}
                            {!completed && <button onClick={onComplete} style={{ width: '100%', padding: 12, border: '2px dashed #475569', borderRadius: 10, background: 'transparent', color: '#94a3b8', cursor: 'pointer', fontSize: 14 }}>Mark Complete</button>}
                        </div>
                    )}
                </div>
            );
        };

        function App() {
            const [week, setWeek] = useState(() => loadFromStorage('recovery-week', 1));
            const [completed, setCompleted] = useState(() => loadFromStorage('recovery-completed', {}));
            const [tab, setTab] = useState('today');

            // Save to localStorage when state changes
            useEffect(() => { saveToStorage('recovery-week', week); }, [week]);
            useEffect(() => { saveToStorage('recovery-completed', completed); }, [completed]);

            const program = weeklyPrograms[week];
            const today = new Date().toDateString();
            const dayKey = `${week}-${today}`;
            const todayDone = completed[dayKey] || [];

            const allExercises = [...new Set([...program.morning, ...program.midday, ...program.evening])];
            const dayPct = (todayDone.length / allExercises.length) * 100;

            const markDone = (id) => {
                if (!todayDone.includes(id)) {
                    setCompleted({ ...completed, [dayKey]: [...todayDone, id] });
                }
            };

            const resetDay = () => setCompleted({ ...completed, [dayKey]: [] });

            const phaseColors = ['#667eea', '#22c55e', '#f59e0b', '#ef4444'];

            return (
                <div>
                    <div style={{ textAlign: 'center', marginBottom: 16 }}>
                        <h1 style={{ fontSize: 24, margin: 0 }}>üèãÔ∏è L5-S1 Recovery</h1>
                        <p style={{ color: '#94a3b8', margin: '4px 0' }}>12-Week Rehabilitation Program</p>
                    </div>

                    <div style={{ display: 'flex', gap: 4, marginBottom: 16, flexWrap: 'wrap', justifyContent: 'center' }}>
                        {[1,2,3,4,5,6,7,8,9,10,11,12].map(w => (
                            <button key={w} onClick={() => setWeek(w)} style={{ width: 28, height: 28, borderRadius: '50%', border: 'none', background: w === week ? '#667eea' : '#334155', color: '#fff', fontSize: 11, fontWeight: 'bold', cursor: 'pointer', transition: 'all 0.2s' }}>{w}</button>
                        ))}
                    </div>

                    <div style={{ background: 'rgba(255,255,255,0.05)', borderRadius: 12, padding: 14, marginBottom: 16, border: '1px solid rgba(255,255,255,0.1)' }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 8 }}>
                            <div>
                                <div style={{ fontWeight: 'bold', fontSize: 16 }}>{program.name}</div>
                                <div style={{ color: '#94a3b8', fontSize: 13 }}>{program.desc}</div>
                            </div>
                            <span style={{ background: phaseColors[program.phase - 1], padding: '4px 10px', borderRadius: 10, fontSize: 11, fontWeight: 600 }}>Phase {program.phase}</span>
                        </div>
                    </div>

                    <div style={{ display: 'flex', gap: 8, marginBottom: 16 }}>
                        <button onClick={() => setTab('today')} style={{ flex: 1, padding: 10, border: 'none', borderRadius: 10, background: tab === 'today' ? '#667eea' : 'rgba(255,255,255,0.1)', color: '#fff', fontWeight: 600, cursor: 'pointer', transition: 'all 0.2s' }}>Today</button>
                        <button onClick={() => setTab('all')} style={{ flex: 1, padding: 10, border: 'none', borderRadius: 10, background: tab === 'all' ? '#667eea' : 'rgba(255,255,255,0.1)', color: '#fff', fontWeight: 600, cursor: 'pointer', transition: 'all 0.2s' }}>All Weeks</button>
                    </div>

                    <div style={{ background: 'rgba(255,255,255,0.05)', borderRadius: 10, padding: 12, marginBottom: 16 }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: 14, marginBottom: 6 }}>
                            <span>Today's Progress</span>
                            <span style={{ fontWeight: 'bold' }}>{todayDone.length}/{allExercises.length}</span>
                        </div>
                        <div style={{ height: 8, background: '#334155', borderRadius: 4, overflow: 'hidden' }}>
                            <div style={{ height: '100%', width: `${dayPct}%`, background: dayPct === 100 ? '#22c55e' : 'linear-gradient(90deg, #667eea, #764ba2)', transition: 'width 0.3s' }}/>
                        </div>
                        {dayPct === 100 && <div style={{ textAlign: 'center', marginTop: 8, color: '#22c55e', fontWeight: 'bold' }}>üéâ Day Complete!</div>}
                        {todayDone.length > 0 && <button onClick={resetDay} style={{ marginTop: 8, padding: '6px 12px', border: 'none', borderRadius: 6, background: 'transparent', color: '#94a3b8', cursor: 'pointer', fontSize: 12 }}>Reset Day</button>}
                    </div>

                    <div style={{ background: 'rgba(102, 126, 234, 0.2)', border: '1px solid rgba(102, 126, 234, 0.4)', borderRadius: 10, padding: 10, marginBottom: 16, fontSize: 13, color: '#a5b4fc' }}>
                        üîä <strong>Sound enabled:</strong> Beeps at 10, 5, 4, 3, 2, 1 sec + completion chime
                    </div>

                    {tab === 'today' ? (
                        <div>
                            {[{ title: 'üåÖ Morning', exercises: program.morning }, { title: '‚òÄÔ∏è Midday', exercises: program.midday }, { title: 'üåô Evening', exercises: program.evening }].map(session => (
                                <div key={session.title} style={{ marginBottom: 16 }}>
                                    <h3 style={{ fontSize: 15, margin: '0 0 10px', color: '#e2e8f0' }}>{session.title}</h3>
                                    {session.exercises.map((id, i) => exerciseData[id] && (
                                        <ExerciseCard key={id} id={id} data={exerciseData[id]} completed={todayDone.includes(id)} onComplete={() => markDone(id)} index={i} />
                                    ))}
                                </div>
                            ))}
                        </div>
                    ) : (
                        <div>
                            {Object.entries(weeklyPrograms).map(([w, data]) => (
                                <div key={w} onClick={() => { setWeek(parseInt(w)); setTab('today'); }} style={{ background: 'rgba(255,255,255,0.05)', borderRadius: 10, padding: 12, marginBottom: 8, cursor: 'pointer', border: `2px solid ${parseInt(w) === week ? '#667eea' : 'rgba(255,255,255,0.1)'}`, transition: 'all 0.2s' }}>
                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                        <span style={{ fontWeight: 'bold' }}>Week {w}</span>
                                        <span style={{ background: phaseColors[data.phase - 1], padding: '2px 8px', borderRadius: 8, fontSize: 10 }}>Phase {data.phase}</span>
                                    </div>
                                    <div style={{ fontSize: 13, color: '#94a3b8', marginTop: 4 }}>{data.desc}</div>
                                </div>
                            ))}
                        </div>
                    )}

                    <div style={{ marginTop: 20, background: 'linear-gradient(135deg, rgba(239,68,68,0.2), rgba(239,68,68,0.1))', border: '1px solid rgba(239,68,68,0.3)', borderRadius: 12, padding: 14 }}>
                        <div style={{ fontWeight: 'bold', color: '#fca5a5', marginBottom: 8 }}>‚ö° Quick Relief Protocol</div>
                        <div style={{ color: '#fecaca', fontSize: 13, lineHeight: 1.6 }}>
                            1. Psoas Position (10-15 min)<br/>
                            2. Prone Lying (5-10 min)<br/>
                            3. Press-Ups (10 reps)<br/>
                            4. Ice (15-20 min)
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
